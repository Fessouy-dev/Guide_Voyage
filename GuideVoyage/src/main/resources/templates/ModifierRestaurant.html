<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Modifier un Restaurant</title>
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <!-- jQuery (requis pour Select2) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
        .select2-container {
            width: 100% !important;
            margin-bottom: 15px;
        }
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        form {
            max-width: 600px;
            margin: 0 auto;
        }
        input, select, textarea {
            margin-bottom: 15px;
            padding: 8px;
            width: 100%;
        }
        .photo-container {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .photo-preview {
            max-width: 150px;
            max-height: 100px;
            margin-top: 8px;
            display: none;
        }
        .add-photo-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 10px 0;
            cursor: pointer;
            border-radius: 4px;
        }
        .remove-photo-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 4px 8px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            margin-left: 10px;
            cursor: pointer;
            border-radius: 4px;
        }
        .current-photo {
            max-width: 200px;
            margin: 10px 0;
        }
        .submit-btn {
            background-color: #2196F3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
<h1>Modifier un Restaurant</h1>

<form th:action="@{/admin/ModifierRestaurant/{id}(id=${restaurant.id})}" method="post" enctype="multipart/form-data">
    <!-- Champs existants -->
    <label for="nom">Nom:</label>
    <input type="text" id="nom" name="nom" th:value="${restaurant.nom}" required/>
    <br/>

    <label for="description">Description:</label>
    <textarea id="description" name="description" rows="4" required th:text="${restaurant.description}"></textarea>
    <br/>

    <label for="localisation">Localisation:</label>
    <input type="text" id="localisation" name="localisation" th:value="${restaurant.localisation}" required/>
    <br/>

    <!-- Photo principale actuelle -->
    <div class="photo-container">
        <label>Photo principale actuelle:</label>
        <img th:src="${restaurant.photo}" alt="Photo actuelle" class="current-photo"/>
    </div>

    <!-- Nouvelle photo principale -->
    <label for="photoFile">Nouvelle photo principale:</label>
    <input type="file" id="photoFile" name="photoFile" accept="image/*"/>
    <img id="preview-main" class="photo-preview"/>
    <br/>

    <!-- Photos additionnelles actuelles -->

    <div th:if="${restaurant.photos ne null and not #lists.isEmpty(restaurant.photos)}">
        <h3>Photos additionnelles actuelles</h3>
        <div th:each="photo : ${restaurant.photos}" class="photo-container">
            <img th:src="${photo}" alt="Photo additionnelle" class="current-photo"/>
        </div>
    </div>

    <!-- Nouvelles photos additionnelles -->
    <h3>Nouvelles photos additionnelles</h3>
    <div id="photos-container">
        <div class="photo-container">
            <label>Photo:</label>
            <input type="file" name="additionalPhotos" accept="image/*" class="photo-input" onchange="previewPhoto(this)"/>
            <img class="photo-preview"/>
            <button type="button" class="remove-photo-btn" onclick="removePhotoContainer(this)">Supprimer</button>
        </div>
    </div>

    <button type="button" class="add-photo-btn" id="add-photo-btn">Ajouter une autre photo</button>
    <br/>

    <label for="specialite">Spécialité:</label>
    <select id="specialite" name="specialiter" required>
        <option value="" disabled>-- Sélectionnez une spécialité --</option>
        <option th:each="spec : ${specialites}"
                th:value="${spec}"
                th:selected="${spec == restaurant.specialiter}"
                th:text="${spec}">
        </option>
    </select>
    <br/>

    <!-- Ville information -->
    <h3>Ville</h3>
    <label for="villeNom">Nom de la ville:</label>
    <select id="villeNom" name="ville.nom" required>
        <option value="" disabled>-- Sélectionnez une ville --</option>
        <option value="Casablanca" th:selected="${restaurant.ville.nom eq 'Casablanca'}">Casablanca</option>
        <option value="Rabat" th:selected="${restaurant.ville.nom eq 'Rabat'}">Rabat</option>
        <option value="Marrakech" th:selected="${restaurant.ville.nom eq 'Marrakech'}">Marrakech</option>
        <option value="Fès" th:selected="${restaurant.ville.nom eq 'Fès'}">Fès</option>
        <option value="Tanger" th:selected="${restaurant.ville.nom eq 'Tanger'}">Tanger</option>
        <option value="Meknès" th:selected="${restaurant.ville.nom eq 'Meknès'}">Meknès</option>
        <option value="Agadir" th:selected="${restaurant.ville.nom eq 'Agadir'}">Agadir</option>
        <option value="Oujda" th:selected="${restaurant.ville.nom eq 'Oujda'}">Oujda</option>
        <option value="Kénitra" th:selected="${restaurant.ville.nom eq 'Kénitra'}">Kénitra</option>
        <option value="Tétouan" th:selected="${restaurant.ville.nom eq 'Tétouan'}">Tétouan</option>
        <option value="Safi" th:selected="${restaurant.ville.nom eq 'Safi'}">Safi</option>
        <option value="Mohammédia" th:selected="${restaurant.ville.nom eq 'Mohammédia'}">Mohammédia</option>
        <option value="El Jadida" th:selected="${restaurant.ville.nom eq 'El Jadida'}">El Jadida</option>
        <option value="Béni Mellal" th:selected="${restaurant.ville.nom eq 'Béni Mellal'}">Béni Mellal</option>
        <option value="Nador" th:selected="${restaurant.ville.nom eq 'Nador'}">Nador</option>
    </select>
    <br/>

    <label for="villePays">Pays:</label>
    <input type="text" id="villePays" name="ville.pays" th:value="${restaurant.ville.pays}" readonly required/>
    <br/>

    <button type="submit" class="submit-btn">Enregistrer les modifications</button>
</form>

<script>
    $(document).ready(function() {
        // Initialisation de Select2 pour la ville
        $('#villeNom').select2({
            placeholder: "Rechercher une ville...",
            allowClear: true,
            language: {
                noResults: function() {
                    return "Ville non trouvée";
                }
            }
        });

        // Preview pour la photo principale
        $("#photoFile").change(function() {
            readURL(this, "#preview-main");
        });

        // Ajouter une autre photo
        $("#add-photo-btn").click(function() {
            const photoContainer = `
                <div class="photo-container">
                    <label>Photo:</label>
                    <input type="file" name="additionalPhotos" accept="image/*" class="photo-input" onchange="previewPhoto(this)"/>
                    <img class="photo-preview"/>
                    <button type="button" class="remove-photo-btn" onclick="removePhotoContainer(this)">Supprimer</button>
                </div>
            `;
            $("#photos-container").append(photoContainer);
        });
    });

    // Fonction pour prévisualiser l'image principale
    function readURL(input, previewId) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function(e) {
                $(previewId).attr('src', e.target.result);
                $(previewId).css('display', 'block');
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    // Fonction pour prévisualiser les images additionnelles
    function previewPhoto(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function(e) {
                $(input).next('.photo-preview').attr('src', e.target.result);
                $(input).next('.photo-preview').css('display', 'block');
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    // Fonction pour supprimer un conteneur de photo
    function removePhotoContainer(button) {
        $(button).parent('.photo-container').remove();
    }
</script>
</body>
</html>